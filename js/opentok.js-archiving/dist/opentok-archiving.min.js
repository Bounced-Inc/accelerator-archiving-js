var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};(function(){var e=void 0;e="object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?require("jquery"):this.$;var i=void 0,n=void 0,t=void 0,o=!1,r=!1,c=void 0,s=void 0,a=function(e,i){c&&c.triggerEvent(e,i)},d=function(){return['<div id="otsArchivingModal" class="ots-archiving-modal">','<div class="modal-content">','<div class="modal-header">',"<h2>Archive is being prepared</h2>",'<span id="closeArchiveModal" class="close-button"></span>',"</div>",'<div class="modal-info">',"<span class=\"message\"> Your session archive file is now being prepared. You'll recieve a notification as soon as it's ready.  Please be patient, this won't take long.</span>","</div>",'<div class="modal-buttons">','<div id="closeArchiveModalBtn" class="btn ok" target="_blank">Ok, Thanks!</div>',"</div>","</div>","</div>"].join("\n")},l=function(e){var i=new Date(null);i.setSeconds(e.duration);var n=i.toISOString().substr(11,8),t=(e.size/1e6).toString().slice(0,5)+"mb";return['<div id="otsArchivingModal" class="ots-archiving-modal">','<div class="modal-content">','<div class="modal-header">',"<h2>Archive is ready</h2>",'<span id="closeArchiveModal" class="close-button"></span>',"</div>",'<div class="modal-info">','<span class="archive-id">'+e.id+"</span>",'<div class="archive-details">Archive details: '+n+" / "+t+"</div>","</div>",'<div class="modal-buttons">','<a href="'+e.url+'" class="btn download" target="_blank">Download Archive</a>',"</div>","</div>","</div>"].join("\n")},v=function(e){var i=document.getElementById("otsArchivingModal");i&&i.remove();var n=e?l(e):d(),t=document.querySelector("#otsWidget")||document.body,o=document.createElement("div");o.innerHTML=n;var r=o.firstChild;t.appendChild(r);var c=document.getElementById("closeArchiveModal"),s=document.getElementById("closeArchiveModalBtn");c.onclick=function(){return r.remove()},s&&(s.onclick=function(){return r.remove()})},u=function(){e.post(i,{sessionId:s.id}).then(function(e){t=e,a("startArchive",e)}).fail(function(e){a("archiveError",e)})},f=function(){a("stopArchive"),v(),e.post(n,{archiveId:t.id}).then(function(e){v(e),a("archiveReady",e)}).fail(function(e){a("archiveError",e)})},h=function(e){var i=document.querySelector(e),n='<div class="ots-video-control circle archiving enabled" id="enableArchiving"></div>',t=document.createElement("div");t.innerHTML=n;var c=t.firstChild;i.appendChild(c),r=!0,c.onclick=function(){o?(o=!1,document.querySelector("#enableArchiving").classList.remove("active"),f()):(o=!0,document.querySelector("#enableArchiving").classList.add("active"),u())}},m=function(){var e=["startArchive","stopArchive","archiveReady","archiveError"];c.registerEvents(e)},p=function(){c.registerEventListener("startCall",function(){r?document.getElementById("enableArchiving").classList.remove("ots-hidden"):h()}),c.registerEventListener("endCall",function(){document.getElementById("enableArchiving").classList.add("ots-hidden")})},y=function(e){var t=["session","startURL","stopURL"];t.forEach(function(i){if(!e[i])throw new Error(["OT: Archiving Accelerator Pack requires a",i].join(""))}),s=e.session,i=e.startURL,n=e.stopURL,c=e.accPack},g=function(e){y(e);var i=e.controlsContainer||"#feedControls";h(i),m(),p()};g.prototype={constructor:g},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):this.ArchivingAccPack=g}).call(this);